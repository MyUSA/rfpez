- Section::inject('page_title', $project->title)
- Section::inject('page_action', 'New Bid')

<?php Section::start('additional_scripts') ?>

<?= HTML::script('js/save-bid-draft.js') ?>

<?php Section::stop() ?>

.row

  .span6

    !{ $project->body }

  .span6

    h1 New Bid

    form.new-bid-form(action="#{ route('bids', array($project->id)) }", method="POST")

      input(type="hidden", name="submit_now", value="true")

      - $draft = $project->my_current_bid_draft()
      - $draft_array = $draft ? $draft->to_array() : false
      - $bid = Input::old('bid') ?: $draft_array

      - if ($draft):
        .alert.alert-success You are editing a draft saved on #{$draft->updated_at}.
      - endif;

      .control-group
        label Your Approach
        textarea(name="bid[approach]", placeholder="Give us some quick details of the tools, techniques, and processes you'd use to create a great solution.") #{ $bid["approach"] }

      .control-group
        label Previous Work
        textarea(name="bid[previous_work]", placeholder="Where possible, please provide links") #{ $bid["previous_work"] }

      .control-group
        label Employees who would work on this project
        textarea(name="bid[employee_details]", placeholder="We just need to make sure nobody has been put on a list of people disallowed to work on government contracts") #{ $bid["employee_details"] }

      h4 Prices

      table.table.prices-table
        thead
          tr
            th Deliverable
            th Price
            th &nbsp;
        tbody

          - $i = 0;
          - $draft_deliverable_names = $draft ? $draft->deliverable_names() : false
          - $draft_deliverable_prices = $draft ? $draft->deliverable_prices() : false
          - $deliverable_prices = Input::old('deliverable_prices') ?: $draft_deliverable_prices
          - $deliverable_names = Input::old('deliverable_names') ?: $draft_deliverable_names ?: $project->parsed_deliverables()
          - if ($deliverable_names):
            - foreach($deliverable_names as $deliverable_name):
              tr.deliverables-row
                td
                  input(type="text", name="deliverable_names[]", value="#{ $deliverable_name }")
                td
                  .input-prepend
                    span.add-on $
                    input.deliverable-price(type="text", name="deliverable_prices[]", value="#{ $deliverable_prices[$i] }")

                td
                  a.btn.btn-danger.btn-small.remove-deliverable
                    i.icon-white.icon-trash
              - $i++;
          - else:
            tr.deliverables-row
              td
                input(type="text", name="deliverable_names[]")
              td
                .input-prepend
                  span.add-on $
                  input.deliverable-price(type="text", name="deliverable_prices[]")
              td
                a.btn.btn-danger.btn-small.remove-deliverable
                  i.icon-white.icon-trash

        tfoot
          tr.total-price-row
            th Total Price:
            td#total-price(colspan="2")
          tr
            td(colspan="3")
              a#add-deliverable-button.btn.btn-mini Add Custom Deliverable

      .form-actions
        button.btn.btn-primary(type="submit") Submit Bid
        a.btn#save-draft-button(data-loading-text="All Changes Saved") Save Draft
        span.help-inline note: bids cannot be edited once submitted!
